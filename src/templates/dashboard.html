{% extends "base.html" %}

{% block title %}Dashboard - SCM Pro{% endblock %}

{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h4 class="card-title">Welcome back, {{ current_user.username }}!</h4>
                    <p class="card-text">Your role: <span class="badge bg-primary">{{ current_user.role|capitalize }}</span></p>
                    {% if current_user.role == "admin" %}
                        <p>As an administrator, you have full access to manage users, suppliers, products, inventory, and orders.</p>
                    {% elif current_user.role == "supplier" %}
                        <p>As a supplier, you can manage your supplier profile, your products, and view related inventory and orders.</p>
                    {% elif current_user.role == "user" %}
                        <p>As a user, you can browse products, manage your orders, and view inventory information.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        {# Admin Dashboard Widgets #}
        {% if current_user.role == "admin" %}
            <div class="col-md-4 mb-3">
                <div class="card text-white bg-primary h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="me-3">
                                <div class="text-white-75 small">Total Users</div>
                                <div class="text-lg fw-bold">{{ stats.total_users if stats else "N/A" }}</div>
                            </div>
                            <i class="bi bi-people-fill" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-white stretched-link" href="{{ url_for("frontend.manage_users") }}">View Details</a>
                        <div class="small text-white"><i class="bi bi-chevron-right"></i></div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card text-white bg-success h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="me-3">
                                <div class="text-white-75 small">Total Products</div>
                                <div class="text-lg fw-bold">{{ stats.total_products if stats else "N/A" }}</div>
                            </div>
                            <i class="bi bi-box-seam" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-white stretched-link" href="{{ url_for("frontend.view_products") }}">View Details</a>
                        <div class="small text-white"><i class="bi bi-chevron-right"></i></div>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card text-white bg-warning h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="me-3">
                                <div class="text-white-75 small">Pending Orders</div>
                                <div class="text-lg fw-bold">{{ stats.pending_orders if stats else "N/A" }}</div>
                            </div>
                            <i class="bi bi-hourglass-split" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-white stretched-link" href="{{ url_for("frontend.view_orders", status="Pending") }}">View Details</a>
                        <div class="small text-white"><i class="bi bi-chevron-right"></i></div>
                    </div>
                </div>
            </div>
        {% endif %}

        {# Supplier Dashboard Widgets #}
        {% if current_user.role == "supplier" %}
            <div class="col-md-6 mb-3">
                <div class="card text-white bg-info h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="me-3">
                                <div class="text-white-75 small">Your Products</div>
                                <div class="text-lg fw-bold">{{ stats.supplier_products if stats else "N/A" }}</div>
                            </div>
                            <i class="bi bi-boxes" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-white stretched-link" href="{{ url_for("frontend.view_products") }}">Manage Products</a>
                        <div class="small text-white"><i class="bi bi-chevron-right"></i></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card text-dark bg-light h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="me-3">
                                <div class="text-muted small">Orders with Your Products</div>
                                <div class="text-lg fw-bold">{{ stats.supplier_orders if stats else "N/A" }}</div>
                            </div>
                            <i class="bi bi-receipt" style="font-size: 2rem; color: #6c757d;"></i>
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-dark stretched-link" href="{{ url_for("frontend.view_orders") }}">View Orders</a>
                        <div class="small text-dark"><i class="bi bi-chevron-right"></i></div>
                    </div>
                </div>
            </div>
        {% endif %}

        {# User Dashboard Widgets #}
        {% if current_user.role == "user" %}
            <div class="col-md-6 mb-3">
                <div class="card text-white bg-secondary h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="me-3">
                                <div class="text-white-75 small">Your Orders</div>
                                <div class="text-lg fw-bold">{{ stats.user_orders if stats else "N/A" }}</div>
                            </div>
                            <i class="bi bi-cart-check-fill" style="font-size: 2rem;"></i>
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-white stretched-link" href="{{ url_for("frontend.view_orders") }}">View Your Orders</a>
                        <div class="small text-white"><i class="bi bi-chevron-right"></i></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card text-dark bg-light h-100">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="me-3">
                                <div class="text-muted small">Browse Products</div>
                                <div class="text-lg fw-bold">Shop Now!</div>
                            </div>
                            <i class="bi bi-shop" style="font-size: 2rem; color: #6c757d;"></i>
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-dark stretched-link" href="{{ url_for("frontend.shop_products") }}">Go to Shop</a>
                        <div class="small text-dark"><i class="bi bi-chevron-right"></i></div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>

    {# Example Chart - Admin Only #}
    {% if current_user.role == "admin" and chart_data %}
    <div class="row mt-4">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header">
                    <i class="bi bi-bar-chart-line-fill me-1"></i>
                    Order Trends (Last 7 Days)
                </div>
                <div class="card-body">
                    <canvas id="orderTrendChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card shadow-sm">
                <div class="card-header">
                    <i class="bi bi-pie-chart-fill me-1"></i>
                    Product Categories Distribution
                </div>
                <div class="card-body">
                    <canvas id="categoryPieChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

</div>
{% endblock %}

{% block scripts_extra %}
{% if current_user.role == "admin" and chart_data %}
<script>
    // Order Trend Chart
    const orderTrendCtx = document.getElementById("orderTrendChart");
    if (orderTrendCtx) {
        new Chart(orderTrendCtx, {
            type: "line",
            data: {
                labels: {{ chart_data.order_trend.labels | tojson }},
                datasets: [{
                    label: "Orders",
                    data: {{ chart_data.order_trend.data | tojson }},
                    borderColor: "rgba(75, 192, 192, 1)",
                    backgroundColor: "rgba(75, 192, 192, 0.2)",
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: { stepSize: 1 }
                    }
                }
            }
        });
    }

    // Category Pie Chart
    const categoryPieCtx = document.getElementById("categoryPieChart");
    if (categoryPieCtx) {
        new Chart(categoryPieCtx, {
            type: "pie",
            data: {
                labels: {{ chart_data.category_distribution.labels | tojson }},
                datasets: [{
                    label: "Products",
                    data: {{ chart_data.category_distribution.data | tojson }},
                    backgroundColor: [
                        "rgba(255, 99, 132, 0.7)",
                        "rgba(54, 162, 235, 0.7)",
                        "rgba(255, 206, 86, 0.7)",
                        "rgba(75, 192, 192, 0.7)",
                        "rgba(153, 102, 255, 0.7)",
                        "rgba(255, 159, 64, 0.7)"
                    ],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    }
</script>
{% endif %}
{% endblock %}

